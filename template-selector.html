<dom-module id="template-selector">
	<script>
		/*global Polymer*/
		"use strict";
Polymer({

	is: 'template-selector',

	properties: {

		template: {
			type: Object,
			observer: '_templateChanged'
		},

		item: {
			type: Object
		},
		folded: {
			type: Boolean
		}


	},

	observers: [
		'_update(template, item, folded)'
	],

	_templates: null,

	ready: function () {
		this._templates = {};
	},

	_update: function (template, item, folded) {
		var templateInstance = this._templates[this.template.id];
		templateInstance.item = item;
		templateInstance.folded = folded;
		this.fire('template-updated', {
			selector: this,
			item: item,
			templateInstance: templateInstance
		}, {
			bubbles: true,
			cancelable: false
		});
	},

	_templateChanged: function (newTemplate, oldTemplate) {
		var
			newInstance = this._templates[newTemplate.id],
			oldInstance;

		if (!newInstance) {
			newInstance = newTemplate.instantiateTemplate();
			this._templates[newTemplate.id] = newInstance;
			Polymer.dom(this).appendChild(newInstance.root);
		} else {
			newInstance._showHideChildren(false);
		}

		if (oldTemplate) {
			oldInstance = this._templates[oldTemplate.id];
			if (oldInstance) {
				oldInstance._showHideChildren(true);
			}
		}
	},

	detached: function () {
		console.log('selector detached');
	}

});
	</script>
</dom-module>
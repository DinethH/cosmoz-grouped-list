<dom-module id="template-selector">
	<script>
		/*global Polymer*/
		"use strict";
		Polymer({

			is: 'template-selector',

			properties: {

				template: {
					type: Object,
					observer: '_templateChanged'
				},
				item: {
					type: Object
				}

			},
			observers: [
				'_itemChanged(item.*)'
			],

			_templates: null,

			ready: function () {
				this._templates = {};
			},

			attached: function () {

			},

			_itemChanged: function (change) {
				if (change.path === "item") {
					var templateInstance = this._templates[this.template.id];
					templateInstance['item'] = change.value;
				} else {
					console.warn('template-selector _itemChanged path', change.path);
				}
			},


			_templateChanged: function (newTemplate, oldTemplate) {
				var
					newInstance = this._templates[newTemplate.id],
					oldInstance;

				if (!newInstance) {
					newInstance = newTemplate.instantiateTemplate();
					this._templates[newTemplate.id] = newInstance;
					Polymer.dom(this).appendChild(newInstance.root);
				} else {
					newInstance._showHideChildren(false);
				}

				if (oldTemplate) {
					oldInstance = this._templates[oldTemplate.id];
					if (oldInstance) {
						oldInstance._showHideChildren(true);
					}
				}

			},

			detached: function () {
				console.log('selector detached');
			}

		});
	</script>
</dom-module>
<dom-module id="cosmoz-grouped-list-template-selector">
	<template>
		<div id="content"></div>
	</template>
</dom-module>

<script>
	/*global Polymer*/
	'use strict';
	Polymer({

		is: 'cosmoz-grouped-list-template-selector',

		properties: {
			item: {
				type: Object,
				observer: '_itemChanged'
			},

			currentTemplate: {
				type: Object
			},

			currentTemplateInstance: {
				type: Object
			}
		},

		_isAttached: false,

		_fireItemChangedOnAttached: false,

		attached: function () {
			this._isAttached = true;
			if (this._fireItemChangedOnAttached) {
				this.fire('template-selector-item-changed', {
					selector: this,
					item: this.item,
				});

				this._fireItemChangedOnAttached = false;
			}
		},

		detached: function () {
			this._isAttached = false;
		},

		_itemChanged: function (newItem, oldItem) {
			if (this._isAttached) {
				this.fire('template-selector-item-changed', {
					selector: this,
					item: newItem,
				});
			} else {
				this._fireItemChangedOnAttached = true;
			}
		},

		_detachInstance: function (templateInstance) {
			var
				parent = Polymer.dom(this.$.content),
				children = parent.childNodes,
				i;
				if (children) {
					for (i = 0 ; i < children.length ; i+=1) {
						parent.removeChild(children[i]);
						templateInstance.root.appendChild(children[i]);
					}
				}
		},

		render: function (template, templateInstance) {
			if (this.currentTemplateInstance) {
				this._detachInstance(this.currentTemplateInstance);
			}

			Polymer.dom(this.$.content).appendChild(templateInstance.root);

			this.currentTemplateInstance = templateInstance;
			this.currentTemplate = template;
		}

	});
</script>
